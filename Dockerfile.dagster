# Dagster webserver and daemon image for production
FROM ghcr.io/astral-sh/uv:0.9.26-python3.12-bookworm-slim

WORKDIR /opt/dagster/app
ENV UV_LINK_MODE=copy
ENV UV_COMPILE_BYTECODE=1

# Install Dagster components
RUN --mount=type=cache,target=/root/.cache/uv \
    uv pip install --system \
    dagster \
    dagster-webserver \
    dagster-postgres

# Create dagster home directory
ENV DAGSTER_HOME=/opt/dagster/dagster_home
RUN mkdir -p /opt/dagster/dagster_home
